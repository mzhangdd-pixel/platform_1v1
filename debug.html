<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ‰‹æŸ„è°ƒè¯•é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f7;
        }
        .card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h2 { color: #1d1d1f; }
        .status { font-size: 18px; padding: 10px; border-radius: 8px; margin: 10px 0; }
        .success { background: #d1f2eb; color: #0c5543; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        pre { background: #f5f5f7; padding: 10px; border-radius: 8px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ® æ‰‹æŸ„ç³»ç»Ÿè°ƒè¯•</h1>

    <div class="card">
        <h2>1. æ–‡ä»¶åŠ è½½æ£€æŸ¥</h2>
        <div id="file-status"></div>
    </div>

    <div class="card">
        <h2>2. Gamepad API æ”¯æŒ</h2>
        <div id="api-status"></div>
    </div>

    <div class="card">
        <h2>3. æ‰‹æŸ„è¿æ¥çŠ¶æ€</h2>
        <div id="gamepad-status"></div>
        <button onclick="checkGamepads()" style="margin-top: 10px; padding: 8px 16px; border-radius: 6px; border: none; background: #007aff; color: white; cursor: pointer;">åˆ·æ–°æ£€æµ‹</button>
    </div>

    <div class="card">
        <h2>4. å®æ—¶è¾“å…¥ç›‘æ§</h2>
        <div id="input-monitor"></div>
    </div>

    <script src="gamepad-handler.js"></script>
    <script src="gamepad-integration.js"></script>
    <script>
        // 1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æˆåŠŸåŠ è½½
        function checkFiles() {
            const status = document.getElementById('file-status');
            let html = '';

            if (typeof GamepadHandler !== 'undefined') {
                html += '<div class="status success">âœ… gamepad-handler.js åŠ è½½æˆåŠŸ</div>';
            } else {
                html += '<div class="status error">âŒ gamepad-handler.js åŠ è½½å¤±è´¥</div>';
            }

            if (typeof gamepadHandlers !== 'undefined') {
                html += '<div class="status success">âœ… gamepad-integration.js åŠ è½½æˆåŠŸ</div>';
            } else {
                html += '<div class="status error">âŒ gamepad-integration.js åŠ è½½å¤±è´¥</div>';
            }

            status.innerHTML = html;
        }

        // 2. æ£€æŸ¥ Gamepad API
        function checkAPI() {
            const status = document.getElementById('api-status');
            let html = '';

            if ('getGamepads' in navigator) {
                html += '<div class="status success">âœ… æµè§ˆå™¨æ”¯æŒ Gamepad API</div>';
                html += `<pre>æµè§ˆå™¨: ${navigator.userAgent}</pre>`;
            } else {
                html += '<div class="status error">âŒ æµè§ˆå™¨ä¸æ”¯æŒ Gamepad API</div>';
            }

            status.innerHTML = html;
        }

        // 3. æ£€æŸ¥æ‰‹æŸ„è¿æ¥
        function checkGamepads() {
            const status = document.getElementById('gamepad-status');
            const gamepads = navigator.getGamepads();
            let html = '';

            const connected = Array.from(gamepads).filter(gp => gp !== null);

            if (connected.length === 0) {
                html += '<div class="status info">â„¹ï¸ æœªæ£€æµ‹åˆ°æ‰‹æŸ„è¿æ¥</div>';
                html += '<p>æç¤º: æŒ‰ä¸‹æ‰‹æŸ„ä»»æ„æŒ‰é”®æ¥æ¿€æ´»è¿æ¥</p>';
            } else {
                html += `<div class="status success">âœ… æ£€æµ‹åˆ° ${connected.length} ä¸ªæ‰‹æŸ„</div>`;
                connected.forEach((gp, index) => {
                    html += `<pre>
æ‰‹æŸ„ ${index + 1}:
  ID: ${gp.id}
  ç´¢å¼•: ${gp.index}
  æ˜ å°„: ${gp.mapping}
  æŒ‰é’®æ•°: ${gp.buttons.length}
  è½´æ•°: ${gp.axes.length}
</pre>`;
                });
            }

            status.innerHTML = html;
        }

        // 4. å®æ—¶ç›‘æ§è¾“å…¥
        let monitorInterval;
        function startMonitor() {
            const monitor = document.getElementById('input-monitor');

            monitorInterval = setInterval(() => {
                const gamepads = navigator.getGamepads();
                const gp = gamepads[0];

                if (!gp) {
                    monitor.innerHTML = '<div class="status info">ç­‰å¾…æ‰‹æŸ„è¿æ¥...</div>';
                    return;
                }

                let html = '<div class="status success">âœ… æ­£åœ¨ç›‘æ§è¾“å…¥</div>';
                html += '<pre>';
                html += `æ‘‡æ†è¾“å…¥:\n`;
                html += `  å·¦æ‘‡æ† X: ${gp.axes[0]?.toFixed(3) || 0}\n`;
                html += `  å·¦æ‘‡æ† Y: ${gp.axes[1]?.toFixed(3) || 0}\n`;
                html += `  å³æ‘‡æ† X: ${gp.axes[2]?.toFixed(3) || 0}\n`;
                html += `  å³æ‘‡æ† Y: ${gp.axes[3]?.toFixed(3) || 0}\n\n`;

                html += `æŒ‰é’®çŠ¶æ€:\n`;
                const buttonNames = ['B(0)', 'A(1)', 'Y(2)', 'X(3)', 'L(4)', 'R(5)', 'ZL(6)', 'ZR(7)'];
                gp.buttons.slice(0, 8).forEach((btn, i) => {
                    const pressed = btn.pressed ? 'âœ…' : 'â¬œ';
                    html += `  ${buttonNames[i]}: ${pressed} (${btn.value.toFixed(2)})\n`;
                });
                html += '</pre>';

                monitor.innerHTML = html;
            }, 100);
        }

        // äº‹ä»¶ç›‘å¬
        window.addEventListener('gamepadconnected', (e) => {
            console.log('æ‰‹æŸ„å·²è¿æ¥:', e.gamepad);
            checkGamepads();
        });

        window.addEventListener('gamepaddisconnected', (e) => {
            console.log('æ‰‹æŸ„å·²æ–­å¼€:', e.gamepad);
            checkGamepads();
        });

        // åˆå§‹åŒ–
        checkFiles();
        checkAPI();
        checkGamepads();
        startMonitor();
    </script>
</body>
</html>
